<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type Vuex without TypeScript | Rahul Kadyan</title>
    <meta name="description" content="A practical guide for type checking vuex modules written in JS and getting things done.">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAusB9Wnh/8sAAAAASUVORK5CYII=">
    <link rel="alternate" type="text/markdown" href="/articles/2018-11-20-type-vuex.md">
    <script type="module" crossorigin src="/_assets/index-CrAebqfu.js"></script>
    <link rel="stylesheet" crossorigin href="/_assets/index-yjBW69Kn.css">
  </head>
  <body>
    <div id="app"><!--[--><a class="hidden" href="#content">Skip to content</a><header class="site-header"><nav aria-label="Primary navigation"><a href="/">Home</a></nav></header><main id="content"><article><!--[--><!--[--><a class="hidden" href="#content">Skip to content</a><header class="site-header"><nav aria-label="Primary navigation"><a href="/">Home</a></nav></header><main id="content"><article><!--[--><!--[--><a class="hidden" href="#content">Skip to content</a><header class="site-header"><nav aria-label="Primary navigation"><a href="/">Home</a></nav></header><main id="content"><article><!--[--><!--[--><a class="hidden" href="#content">Skip to content</a><header class="site-header"><nav aria-label="Primary navigation"><a href="/">Home</a></nav></header><main id="content"><article><!--[--><!--[--><a class="hidden" href="#content">Skip to content</a><header class="site-header"><nav aria-label="Primary navigation"><a href="/">Home</a></nav></header><main id="content"><article><!--[--><!--[--><a class="hidden" href="#content">Skip to content</a><header class="site-header"><nav aria-label="Primary navigation"><a href="/">Home</a></nav></header><main id="content"><article><!--[--><!--[--><h1>Type Vuex without TypeScript</h1><blockquote><p>This is a continuation article to <a href="./2018-type-vue" target="_blank" rel="noopener noreferrer">Type Vue without TypeScript</a>, if you haven’t already read it, I suggest you read that first.</p></blockquote><h2>Vuex does support types!</h2><p>The official state management library for Vue does support TypeScript. It provides MutationTree and ActionTree type helpers to get auto-completion and intellisense in mutations and actions.</p><p><img src="/assets/1-BnqozjI5.png" alt="Vuex store implementation written in TypeScript"></p><p>We can also get types in JavaScript with JSDoc <code>@type</code> annotation.</p><p><img src="/assets/2-BQlXO-Xp.png" alt="Vuex store implementation written in JavaScript"></p><p>If we use options syntax for creating a store, most of the boilerplate comments are unnecessary.</p><p><img src="/assets/3-Bslfh-Hi.png" alt="Vuex store implementation written in JavaScript using options syntax"></p><p>The TypeScript API for Vuex is limited however. Type checks and intellisense in commit and dispatch are very primitive.</p><figure data-type="image"><div stack="" row="" wide=""><img src="/assets/4-BJtctiMc.png" alt="Screenshot: Intellisense in commit methods of vuex store"><img src="/assets/5-CyV0s8iN.png" alt="Screenshot: Intellisense in dispatch methods of vuex store"></div><figcaption>Intellisense in commit (left) and dispatch (right) methods of Vuex store</figcaption></figure><p>As you can see above, we get intellisense to let us know that commit and dispatch take strings as the first argument, but we don’t get a list of registered actions and mutations. There is not much we can do here, with or without TypeScript. However, there are lots of third-party packages trying to get the types right in the Vuex store and modules.</p><p><img src="/assets/6-DIBqQFA6.gif" alt="Vuex helper packages for TypeScript"></p><p>We won’t be introducing new dependencies to a project only to get the types right, as most people are using just Vuex. However, <a href="//github.com/ktsn/vuex-class" target="_blank" rel="noopener noreferrer">vuex-class</a>, <a href="//github.com/istrib/vuex-typescript" target="_blank" rel="noopener noreferrer">vuex-typescript</a> and <a href="//github.com/championswimmer/vuex-module-decorators" target="_blank" rel="noopener noreferrer">vuex-module-decorators</a> are worth mentioning third-party packages assisting Vuex stores.</p><!----><p>The next version of Vuex would be built with an API which plays well with TypeScript.</p><p>We cannot do much with committing mutations and dispatching actions due to limitations in the TypeScript API for Vuex. Though with namespaced modules, we can limit the scope of a store and keep individual store modules comprehendible. However, there is another area of Vuex which can use types and intellisense.</p><h3>Using Vuex Store in Vue components</h3><p>Vuex provides mapState, mapGetters, mapActions and mapMutations helpers to simplify binding store state in Vue components. However, the API is string literals based and sort of impossible to provide types and intellisense.</p><p><img src="/assets/7-M3zxuUol.png" alt="Using Vuex store in Vue component" small=""></p><p>This problem is still unsolved in the TypeScript world, and there is not much we can do in the JavaScript world. However, there exists a pattern, and to my knowledge, popularised by <a href="//twitter.com/chrisvfritz" target="_blank" rel="noopener noreferrer">Chris Fritz</a>’s <a href="//github.com/chrisvfritz/vue-enterprise-boilerplate" target="_blank" rel="noopener noreferrer">Enterprise Boilerplate</a> which can be enhanced.</p><h3>Helpers pattern in Vuex</h3><p>According to Chris’ helper pattern, we create a store helper file, and all the mapXxx method calls of Vuex store usages are collected here. We can create contextual groups of computed and methods properties which can be added to components directly.</p><p><img src="/assets/8-CxNvcxE4.png" alt="Vuex helper pattern example" small=""></p><p>Other than providing possibilities of intellisense enhancements, this pattern reduces the surface area affected by Vuex in an application. Let’s say if Vuex introduces breaking changes then we have to update only helpers.js file. Also, it reduces code footprint and increases reuse of mapXxx across packages.</p><h3>Intellisense for Vuex stores written with helpers pattern</h3><p>We can annotate exports from helpers in such a way that we get better intellisense when used in the component.</p><p>e.g., In the following code snippet, addTodo method accepts a text argument of type string.</p><p><img src="/assets/9-ahcXzF5b.png" alt="Intellisense in Vuex mapped methods" small=""></p><p>Intellisense in above snippet is not automatic; it requires some type-casts using JSDocs. e.g., There should be addTodo method on the type of todosMethods object exported by helpers module. So with a type definition using @typedef, we can name this type TodoMethods.</p><p><img src="/assets/10-rVszHpV-.png" alt="Vuex helpers with JSDoc type annotations" small=""></p><p>In the above type definition, TodoMethods has a property addTodo of type function. To define a function type, we can use a double curly bracket, similar to Vue’s moustache syntax (<code>{{ ... }}</code>). In the double curly brackets, we add types in format (param: type): return-type and hence for a function accepting one string argument, we have <code>{{ (text: string): void }}</code>. As we know an action always returns a promise, we can augment addTodo method type to <code>{{ (text: string): Promise&lt;void&gt; }}</code>. Similarly, we can add a type to computed properties, but as required by API, these should be functions.</p><p><img src="/assets/11-DpGttMf7.png" alt="VS Code Type Inference" small=""></p><p>This approach is a little brittle as any changes in properties used in <code>mapXxx</code> could potentially effect JSDoc type definitions. Also, any new property added to mapXxx functions requires type definition to be added to the corresponding typedef.</p><p>Also, if you noticed the type of <code>completedTodos</code> in the above snippet, it says <code>any[]</code>. It’s due to a bug in VS Code which does not show imported types correctly.</p><p><img src="/assets/12-Bks9Zzdt.png" alt="JSDoc type hint"></p><p><img src="/assets/13-DaHLSGuR.png" alt="Bug in VS Code which fails to display imported files (outdated)" small=""></p><p>That’s all folks for Vuex and types without TypeScript. If you have question about it, you can reach me on Twitter (<a href="//twitter.com/znck0" target="_blank" rel="noopener noreferrer">@znck0</a>).</p><!--]--><!--]--></article></main><!--]--><!--]--></article></main><!--]--><!--]--></article></main><!--]--><!--]--></article></main><!--]--><!--]--></article></main><!--]--><!--]--></article></main><!--]--></div>
  </body>
</html>