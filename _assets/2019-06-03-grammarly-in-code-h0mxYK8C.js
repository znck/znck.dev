import{_ as h,a as n,b as s,c as r,d as a,e as F,w as k,F as o,r as e,o as B}from"./index-BkSg2UFs.js";const p="https://znck.dev/_assets/screenshot-google-search-2-Dto8dABI.png",d="https://znck.dev/_assets/screenshot-yeoman-CnmZr87_.png",g="https://znck.dev/_assets/screenshot-grammarly-clUtP2JH.png",c="https://znck.dev/_assets/screenshot-ws-B6r0839Q.png",y="https://znck.dev/_assets/screenshot-ext-Ckxyxl0T.png",l={type:"article",title:"Grammarly in Code",description:`There's no simpler writing tool than markdown. There's no elegant editor than code. There's no better writing environment than markdown in <span title="VS Code">code</span>. It's perfect, but whenever I write, I find myself copy-pasting back and forth between Grammarly editor and VS Code editor. Grammarly makes my writing much better, but it also forces me to use their editor. Don't take me wrong I don't hate their editor, in fact, I kind of like it — clean, spacious, and responsive. But it's not sufficient for me as my articles generally have images, code snippets, figures, and sometimes markup. The lack of syntax highlight for markdown and markup is an absolute deal-breaker. If Grammarly worked in VS Code editor, wouldn't that be perfect?`,tags:["diy","vscode","extension"],filePath:"articles/2019-06-03-grammarly-in-code.md",url:"/articles/2019-06-03-grammarly-in-code",canonicalUrl:"https://znck.dev/articles/2019-06-03-grammarly-in-code.html",author:"Rahul Kadyan",published:"2019-06-03T00:00:00.000Z",frontmatter:{published:"2019-11-09T00:00:00.000Z",tags:["diy","vscode","extension"],image:"./screenshot-ext.png"}};l.published=new Date(l.published);const f={};function m(u,i,D,E,A,q){const t=e("tweet");return B(),n(o,null,[i[1]||(i[1]=s("h1",null,"Grammarly in Code",-1)),i[2]||(i[2]=s("p",null,[a("There's no simpler writing tool than markdown. There's no elegant editor than "),s("a",{target:"_blank",rel:"noopener noreferrer",href:"https://code.visualstudio.com"},"code"),a(". There's no better writing environment than markdown in "),s("span",{title:"VS Code"},"code"),a(". It's perfect, but whenever I write, I find myself copy-pasting back and forth between Grammarly editor and VS Code editor. Grammarly makes my writing much better, but it also forces me to use their editor. Don't take me wrong I don't hate their editor, in fact, I kind of like it — clean, spacious, and responsive. But it's not sufficient for me as my articles generally have images, code snippets, figures, and sometimes markup. The lack of syntax highlight for markdown and markup is an absolute deal-breaker. If Grammarly worked in VS Code editor, wouldn't that be perfect?")],-1)),i[3]||(i[3]=s("p",null,"I searched the code marketplace for a Grammarly extension, but there wasn't one. So, I continued jumping between Grammarly and Code, waiting for someone to remedy my pain. A year passed, but nobody came up with a solution. I couldn't bear it anymore; I had to help me; I had to build the integration myself. And, the journey of getting Grammarly in Code began.",-1)),i[4]||(i[4]=s("h2",null,"Hunt for Grammarly API",-1)),i[5]||(i[5]=s("p",null,'"Grammarly API" — I entered in the Google white box and hit enter; the results disappointed me.',-1)),s("p",null,[F(t,{id:"388621218586578944"},{default:k(()=>i[0]||(i[0]=[a("No API--yet! We'll keep you posted! — @Grammarly")])),_:1,__:[0]})]),i[6]||(i[6]=r('<p>No API -- yet! It&#39;s been six years since they first acknowledged that they don&#39;t have a public API. I don&#39;t think developer environments ever make to their priority list.</p><p>Hence, &quot;Grammarly API Github&quot; — I hit Google again.</p><p><img src="'+p+'" alt="Screenshot of Google search results for query &quot;Grammarly API Github&quot;"></p><p>I found something — a reverse-engineered <a target="_blank" rel="noopener noreferrer" href="https://github.com/stewartmcgown/grammarly-api">Grammarly client</a>. It&#39;s a sound library, and I decided to base my extension on this library.</p><h2>Building the Extension</h2><p>I wanted to validate the idea with minimum efforts, so I looked for a project scaffold to kickstart the extension. VS Code has <a target="_blank" rel="noopener noreferrer" href="https://yeoman.io">yeoman</a> generator. Hence, all I needed was to run the command <code>yo code</code>.</p><p><img src="'+d+`" alt="Screenshot of Yeoman Visual Studio Code Generator running in iTerm2 zsh shell"></p><p>I picked the very first option: &quot;New Extension (TypeScript)&quot;, and I got a good starting point. Next, I needed to create a small language server to analyze text content with Grammarly API and post grammar diagnostics. The Code&#39;s <a target="_blank" rel="noopener noreferrer" href="https://code.visualstudio.com/api/language-extensions/language-server-extension-guide">Language Server Extension Guide</a> proved to be an excellent resource. I got the extension working in very few lines of code.</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-ts"><span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { createConnection</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> TextDocuments } </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">from</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;vscode-languageserver&#39;</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { Grammarly } </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">from</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;@stewartmcgown/grammarly-api&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// Create a connection for the server.</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> connection</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createConnection</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">// Create a simple text document manager.</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> documents</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextDocuments</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextDocuments</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">connection</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.onInitialize</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(() </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  capabilities</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    textDocumentSync</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> documents</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.syncKind</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">documents</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.onDidChangeContent</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">async</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ({ document }) </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> results</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> await</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Grammarly</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.analyze</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">document</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.getText</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> diagnostics</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> results</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">alerts</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.map</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(() </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    /*</span></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    convert results to Code diagnostics.</span></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    ...</span></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">    */</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">  // Send diagnostics</span></span>
<span class="line"><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">  connection</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.sendDiagnostics</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">({</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    uri</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> document</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.uri</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    diagnostics</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  })</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">})</span></span></code></pre><figcaption>A naive language server implementation to provide grammar diagnostics using Grammarly API</figcaption></figure><p>I got it working. I could see red twiddling underlines screaming at me.</p><p><img src="`+g+'" alt="Screenshot of VS Code editor highlighting grammar issues and displaying Grammarly diagnostics"></p><p>I started writing, but Grammarly diagnostics was extremely slow. I had to wait for seconds, which is a lot for writing, I expected a near-immediate response. However, the response in Grammarly editor is quite snappy. I guess I was doing something wrong. I wondered how do Grammarly editor work?</p><h2>Peeking into Grammarly API</h2><p>By looking at the network logs in Chrome DevTools, I found Grammarly uses a WebSocket for connecting to the grammar service at <code>wss://capi.grammarly.com/freews</code>.</p><p><img src="'+c+`" alt="Screenshot of Chrome DevTools Network tab showing web socket connection to Grammarly API"></p><p>On further inspection of messages, I found every message has a fixed structure: a message <code>id</code>, <code>action</code>, and the payload required for the <code>action</code>. The <code>id</code> value is from a sequence starting from 0 and incremented on every subsequent message. I guess, the <code>action</code> is the name of the function executed on the server, it looks like an <abbr title="Remote Procedure Call">RPC</abbr> API. For every message sent, the server returned a response with the same <code>id</code> as the message. I needed more data to understand the API, so I started fiddling with the Grammarly editor while monitoring the socket connection.</p><p>The editor starts a conversation with the server by sending a message with <code>start</code> action, which looks like the following snippet:</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-json"><span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;id&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;action&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;start&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;client&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;denali_editor&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;clientSubtype&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;general&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;clientVersion&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;1.5.43-2120+master&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;dialect&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;american&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;docid&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;419610520&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;documentContext&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;goals&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;convince&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;describe&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;inform&quot;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;domain&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;technical&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;audience&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;expert&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;style&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;neutral&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;emotion&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;mild&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;emotions&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">&quot;neutral&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;confident&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;joyful&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;optimistic&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;respectful&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;urgent&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;friendly&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;analytical&quot;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">    &quot;dialect&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;american&quot;</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;clientSupports&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;text_info&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;free_inline_advanced_alerts&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;readability_check&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;sentence_variety_check&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;filler_words_check&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;alerts_update&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;alerts_changes&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;free_clarity_alerts&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;super_alerts&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;consistency_check&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;hidden_alerts_update&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;">    &quot;set_goals_link&quot;</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><figcaption>The first message sent to Grammarly WebSocket server</figcaption></figure><p>And the editor always waited for the response for the <code>start</code> action:</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-json"><span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{ </span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">&quot;sid&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;"> &quot;action&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;start&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;"> &quot;id&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span></span></code></pre><figcaption>Ack from Grammarly server for the start message</figcaption></figure><p>After receiving the acknowledgment for the <code>start</code> action, the editor sends another message with <code>submit_ot</code> action. The <code>submit_ot</code> action sends the contents of the document as payload.</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-json"><span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;id&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;action&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;submit_ot&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;rev&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;doc_len&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;deltas&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    {</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">      &quot;ops&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        {</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">          &quot;insert&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;I got grammarly working in code.\\n\\nAnd it&#39;s pointing at speling mistakes.\\n&quot;</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">        }</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">      ]</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    }</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ]</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><figcaption>Initial message sent to Grammarly server for grammar anaylsis</figcaption></figure><p>In response to the <code>submit_ot</code> action, the server sends a series of <code>alert</code> actions. Each <code>alert</code> action represents some issue in the document. The <code>alert</code> actions are followed by a <code>finished</code> action which signifies end of diagnostics list.</p><p>In <a target="_blank" rel="noopener noreferrer" href="https://github.com/stewartmcgown/grammarly-api">Stewart McGown implementation of Grammarly API</a>, the <code>finished</code> message is used as the end of the transaction, and all <code>alert</code> messages received so far are returned as resolved promise form the <code>analyze</code> method. I feel it&#39;s sufficient for immutable text, but I don&#39;t have immutable text, my text changes with every keypress. So, I started editing in Grammarly editor and monitored the socket connection.</p><p>The editor sends <code>submit_ot</code> action on every change.</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-json"><span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;id&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;action&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;submit_ot&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;rev&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;doc_len&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 74</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;deltas&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ </span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">&quot;ops&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ </span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">&quot;retain&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 73</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { </span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">&quot;insert&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;a&quot;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }] }]</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-json"><span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">{</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;id&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 4</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;action&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &quot;submit_ot&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;rev&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 2</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;doc_len&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 75</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">  &quot;deltas&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ </span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">&quot;ops&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ </span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">&quot;retain&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 73</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { </span><span style="color:light-dark(#D32F2F, #F8F8F8);--shiki-light:#D32F2F;--shiki-dark:#F8F8F8;">&quot;delete&quot;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }] }]</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><figcaption>Example insertion and deletion messages from Grammarly Operation Transformation messages</figcaption></figure><p>The <code>submit_ot</code> message includes document length (<code>doc_len</code>), revision (<code>rev</code>), and insertion or deletion operations (<code>deltas</code> array with <code>ops</code>). Recently, I have been reading about conflict-free replication in distributed data structures, and I feel the <code>ot</code> in <code>submit_ot</code> stands for <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Operational_transformation">operational transformation</a>. Grammarly&#39;s OT (or operational transformation) implementation seems to use revision (<code>rev</code>) and document length (<code>doc_len</code>) for state assertion and <code>deltas</code> for transformation messages. In response to <code>submit_ot</code> action, the server would send a series of <code>alert</code> actions, which got affected by the change triggered by <code>submit_ot</code> action, followed by a <code>finished</code> action.</p><p>I wondered, if I could generate these operational transformation messages from Code&#39;s content change events, I could potentially get realtime diagnostics from Grammarly.</p><h2>Generationg Operational Transformations</h2><p>The language server protocol support incremental document synchronization with the Code editor, however, Code&#39;s content change events are slightly different. The change event uses range replacement, which makes synchronization simple and it requires less number of messages.</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-ts"><span class="line"><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">connection</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.onDidChangeTextDocument</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">((event) </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">=&gt;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { </span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">document</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> change</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> } </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> event</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { </span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">range</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> text</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> } </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> change</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> content</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> document</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.getText</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">()</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> offsetStart</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> document</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.offsetAt</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">range</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.start)</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> offsetEnd</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> document</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.offsetAt</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">range</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.end)</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">  // New revision of document.</span></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">  const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> newDocument</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> new</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TextDocument</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">    document</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">.rev </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">+</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;">    content</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.substr</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">0</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> offsetStart) </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">+</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> text </span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">+</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> content</span><span style="color:light-dark(#6F42C1, #B392F0);--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.substr</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(offsetEnd)</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  )</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">})</span></span></code></pre><figcaption>Example implementation of incremental document sync using content change events</figcaption></figure><p>But, for Grammarly, we have to transform these range replacement events to operational transformation messages. There are three possible scenarios in range replacement:</p><ol><li><p>Insert non-empty text in an empty range</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-ts"><span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> event</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  range</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    start</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { line</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> column</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    end</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { line</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> column</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  text</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;a&#39;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> OT</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ops</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ retain</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 73</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { insert</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;a&#39;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }]</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#C2C3C5, #6B737C);--shiki-light:#C2C3C5;--shiki-dark:#6B737C;">  // 73 is offest at Line 3 Column 0</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><figcaption>Code displaying same message as VS Code change event and Grammarly OT</figcaption></figure></li><li><p>Insert empty text in a non-empty range</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-ts"><span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> event</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  range</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    start</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { line</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> column</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    end</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { line</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> column</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  text</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;&#39;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> OT</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ops</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ retain</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 73</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { delete</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }]</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><figcaption>Code displaying same message as VS Code change event and Grammarly OT</figcaption></figure></li><li><p>Insert non-empty text in a non-empty range</p><figure data-type="code"><pre class="shiki shiki-themes min-light min-dark" style="background-color:light-dark(#ffffff, #1f1f1f);--shiki-light-bg:#ffffff;--shiki-dark-bg:#1f1f1f;color:light-dark(#24292eff, #b392f0);--shiki-light:#24292eff;--shiki-dark:#b392f0;" tabindex="0"><code class="language-ts"><span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> event</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  range</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    start</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { line</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> column</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 0</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    end</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { line</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> column</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  text</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;b&#39;</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> OT1</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ops</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ retain</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 73</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { delete</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 1</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }]</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">const</span><span style="color:light-dark(#1976D2, #79B8FF);--shiki-light:#1976D2;--shiki-dark:#79B8FF;"> OT2</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;"> =</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> {</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">  ops</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [{ retain</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#1976D2, #F8F8F8);--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 72</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> { insert</span><span style="color:light-dark(#D32F2F, #F97583);--shiki-light:#D32F2F;--shiki-dark:#F97583;">:</span><span style="color:light-dark(#22863A, #FFAB70);--shiki-light:#22863A;--shiki-dark:#FFAB70;"> &#39;b&#39;</span><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> }]</span><span style="color:light-dark(#212121, #BBBBBB);--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="color:light-dark(#24292EFF, #B392F0);--shiki-light:#24292EFF;--shiki-dark:#B392F0;">}</span></span></code></pre><figcaption>Code displaying same message as VS Code change event and Grammarly OT</figcaption></figure></li></ol><p>So, I ended up reimplementing the Grammarly API hooked it up with Code&#39;s content change events. And I got the near-real-time feedback from Grammarly service. I skipped how I handled authentication in this article, it was tricky one, but I got a good starting point from <a target="_blank" rel="noopener noreferrer" href="https://github.com/stewartmcgown/grammarly-api">Stewart McGown implementation of Grammarly API</a>.</p><h2>Shipping the extension</h2><p>I followed the <a target="_blank" rel="noopener noreferrer" href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension">VS Code Publishing Extension Guide</a> and got my extension on the marketplace. There were some hurdles in bundling the extension, but that deserves an article of its own. So, here I present <a target="_blank" rel="noopener noreferrer" href="https://marketplace.visualstudio.com/items?itemName=znck.grammarly">&quot;Grammarly in Code&quot;</a>.</p><p><img src="`+y+'" alt="Screenshot of Grammarly extension on VS Code marketplace"></p><blockquote><p>Markdown. Code. Grammarly.<br> Now, hear me <del>roar</del> write.</p></blockquote><p>The <a target="_blank" rel="noopener noreferrer" href="https://github.com/znck/grammarly">Grammarly extension is open source</a>, and you can contribute or file issues if you face any problems.</p>',39))],64)}const C=h(f,[["render",m],["__file","2019-06-03-grammarly-in-code.md"]]);export{C as default,l as pageData};
